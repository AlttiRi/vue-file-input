import{d as e,c as t,o as n,a as r,t as a,u as o,r as s,b as l,e as i,f as u,w as c,g as f,h as p,i as d,j as v,n as y,T as m,k as g,l as h,m as E,p as D}from"./vendor.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))processPreload(e);new MutationObserver((e=>{for(const t of e)if("childList"===t.type)for(const e of t.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&processPreload(e)})).observe(document,{childList:!0,subtree:!0})}function processPreload(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const w={class:"default-hover-text"},_export_sfc=(e,t)=>{const n=e.__vccOpts||e;for(const[r,a]of t)n[r]=a;return n},F=_export_sfc(e({__name:"FileInputDefaultHoverText",props:{state:null},setup(e){const s=e,{dropHoverItemCount:l}=s.state.private,i=t((()=>{const e=l.value>1?"s":"";return`Drop ${l.value} file${e}`}));return(e,t)=>(n(),r("div",w,a(o(i)),1))}}),[["__scopeId","data-v-38408848"]]),_=["title"],b={key:0,class:"parsing"},S={key:1},T={key:2,style:{display:"contents"}},I=_export_sfc(e({__name:"FileInputDefaultText",props:{state:null},setup(e){const i=e,{count:u,fileEntries:c,parsing:f}=i.state.private,p=t((()=>c.value.slice(0,50).map((e=>e.name)).join("\n")));return(e,t)=>(n(),r("div",{class:"default-prompt-text",title:o(p)},[o(f)?(n(),r("div",b,"Parsing...")):o(u)?(n(),r("div",S,a(o(u))+" file"+a(o(u)>1?"s":""),1)):(n(),r("div",T,[s(e.$slots,"default",{},(()=>[l("Select file")]),!0)]))],8,_))}}),[["__scopeId","data-v-5f126065"]]),L=["accept","multiple","nwdirectory"],k={key:0,class:"content hover"},H={key:1,class:"content selected"},z={key:2,class:"content prompt"},C=_export_sfc(e({__name:"FileInput",props:{globalDropZone:{type:Boolean,default:!0},dropZoneSelector:{type:String,default:null},accept:{type:String,default:"*/*"},multiple:{type:Boolean,default:!0},state:{type:Object,required:!0},nwdirectory:{type:Boolean,default:!1}},setup(e){const a=e,l=i(null),{globalDropZone:h,dropZoneSelector:E,nwdirectory:D}=u(a),{parsing:w,file:_,dropHover:b,setFiles:S,setDataTransfer:T,setDataTransferHover:C,resetDataTransferHover:N,isNwDirectory:O,inputElem:P}=a.state.private;function onFileInputChange(e){const t=e.target;S(t.files)}c((()=>{O.value=D.value})),f((()=>{P.value=l.value}));const W=i(null),Z=t((()=>E.value?document.querySelector(E.value):h.value?document.body:W.value));function stopEvent(e){e.preventDefault(),e.stopPropagation()}function onDrop(e){stopEvent(e),b.value=!1,T(e.dataTransfer)}function onDragOver(e){stopEvent(e),e.dataTransfer&&(e.dataTransfer.dropEffect="copy")}function onDragEnter(e){stopEvent(e),b.value||(b.value=!0,C(e.dataTransfer))}function onDragLeave(e){stopEvent(e),Z.value?.contains(e.relatedTarget)||(b.value=!1,N())}function onDragOverNonDropZone(e){Z.value?.contains(e.target)||(stopEvent(e),e.dataTransfer&&(e.dataTransfer.dropEffect="none"))}function onKeyDown(e){"Enter"===e.key&&W.value?.querySelector("label")?.click()}return f((()=>{!function(){if(!Z.value)return;Z.value.addEventListener("dragenter",onDragEnter),Z.value.addEventListener("dragleave",onDragLeave),Z.value.addEventListener("drop",onDrop),Z.value.addEventListener("dragover",onDragOver),document.body.addEventListener("dragover",onDragOverNonDropZone)}()})),p((()=>{!function(){if(!Z.value)return;Z.value.removeEventListener("dragenter",onDragEnter),Z.value.removeEventListener("dragleave",onDragLeave),Z.value.removeEventListener("drop",onDrop),Z.value.removeEventListener("dragover",onDragOver),document.body.removeEventListener("dragover",onDragOverNonDropZone)}()})),(t,a)=>(n(),r("div",{class:y(["file-input",{"drop-hover":o(b)}]),ref_key:"fileInputElem",ref:W,tabindex:"0",onKeydown:onKeyDown},[d("label",null,[d("input",{type:"file",accept:e.accept,multiple:e.multiple,onChange:onFileInputChange,style:{display:"none"},nwdirectory:o(D),ref_key:"templateInputElem",ref:l},null,40,L),o(b)?(n(),r("span",k,[s(t.$slots,"hover",{},(()=>[g(F,{state:e.state},null,8,["state"])]),!0)])):o(_)&&!o(w)?(n(),r("span",H,[s(t.$slots,"selected",{},(()=>[g(I,{state:e.state},null,8,["state"])]),!0)])):(n(),r("span",z,[s(t.$slots,"prompt",{},(()=>[g(I,{state:e.state},null,8,["state"])]),!0)]))]),(n(),v(m,{to:"body"},[d("div",{class:y(["file-input-hover-modal",{"drop-hover":o(b)}])},null,2)]))],34))}}),[["__scopeId","data-v-30cd7e1e"]]);class WebFileEntry{constructor({file:e,type:t,name:n,parent:r}){this.file=e,this.type=t,n&&(this._name=n),r&&(this.parent=r,r.addChild(this))}get nativePath(){return this.file.path}get name(){return this._name||this.file.name}addChild(e){this.children||(this.children=[]),this.children.push(e),this.increaseContentSize(e.size)}increaseContentSize(e){e&&(this._contentSize||(this._contentSize=0),this._contentSize+=e,this.parent&&this.parent.increaseContentSize(e))}get size(){return"folder"===this.type?this._contentSize||0:this.file.size||0}get mtime(){return this.file.lastModified||0}get path(){return this.parent?[...this.parent.path,this]:[this]}*[Symbol.iterator](){if(yield this,this.children)for(const e of this.children)yield*e}flat(){return[...this]}static flat(e){return e.map((e=>[...e])).flat()}static async fromDataTransfer(e,t){const n=[...e.items],r=[...e.files],a=await async function(e){const t=[];for(const n of e)t.push(await dtItemToFileSystemEntry(n));return t}(n);console.log("[fileSystemEntries]:",a);const o=[];for(const s of a)o.push(await fromFileSystemEntry(s,null,t,r.shift()));return o}static fromFiles(e,t="file"){const n=[];for(const r of e)n.push(new WebFileEntry({type:t,file:r}));return n}}async function fromFileSystemEntry(e,t=null,n=!1,r){if(!e.isFile){if(e.isDirectory&&n){const a=new WebFileEntry({type:"folder",parent:t,name:e.name,file:r}),o=async function*(e){const t=e.createReader();let n=[];do{n=await new Promise(((e,n)=>t.readEntries(e,n)));for(const e of n)yield e}while(n.length)}(e);for await(const e of o)await fromFileSystemEntry(e,a,n);return a}return new WebFileEntry({type:"folder",parent:t,name:e.name,file:r})}try{const n=await(a=e,new Promise(((e,t)=>a.file(e,t))));return new WebFileEntry({file:n,type:"file",parent:t})}catch(o){return console.error("[fromFileSystemEntry][error]",e.name,o),null}var a}async function dtItemToFileSystemEntry(e){return e.webkitGetAsEntry()}const N="undefined"!=typeof nw&&1===nw.process?.__nwjs;function getStateInstance({recursive:e}={recursive:!1}){const n=i([]),r=i([]),a=i(null),o=i(!1),s=i([]),l=i(null),u=i(!1),f=i(0),p=i([]),d=i(!1);c((async()=>{const t=Date.now();o.value=!0,l.value?(console.log("[fromDataTransferItems]"),n.value=await WebFileEntry.fromDataTransfer(l.value,e)):N&&d.value?(console.log("[isNwDirectory]"),n.value=WebFileEntry.fromFiles(r.value,"folder")):(console.log("[fromFiles]"),n.value=WebFileEntry.fromFiles(r.value)),o.value=!1,console.log("[WebFileEntry parsing][time]:",Date.now()-t,"ms"),console.log("[fileEntries]",E(n.value))}));const v=t((()=>n.value[0])),y=t((()=>n.value.length));function setFiles(e,t=!0){const n=[...e];r.value=n,console.log("[setFiles]:",n),t&&(l.value=null,s.value=[])}return{fileEntries:h(n),clearInput:function(){a.value&&(a.value.value=""),r.value=[],l.value=null,s.value=[]},private:{dropHover:u,dropHoverItemCount:f,dropHoverTypes:p,fileEntries:n,parsing:o,file:v,count:y,setDataTransferHover:function(e){if(!e)return;const t=e.items.length,n=[...e.items].map((e=>e.type)),r=[...new Set(n)];f.value=t,p.value=r,console.log("[setDataTransferHover]:",t,r)},resetDataTransferHover:function(){f.value=0,p.value=[]},setDataTransfer:function(e){e&&(console.log("setDataTransfer",e),setFiles(e.files,!1),function(e){const t=[...e];s.value=t,console.log("[_setDtItems]:",t),console.log("[_setDtItems][0]:",{kind:t[0].kind,type:t[0].type})}(e.items),l.value=e)},setFiles:setFiles,isNwDirectory:d,inputElem:a}}}D({__name:"App",setup(e){const t=getStateInstance({recursive:!0});return globalThis.state=t,(e,r)=>(n(),v(o(C),{state:o(t)},null,8,["state"]))}}).mount("#app");
//# sourceMappingURL=index.js.map
